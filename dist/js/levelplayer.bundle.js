document.addEventListener("DOMContentLoaded",(async()=>{const e=new URLSearchParams(window.location.search).get("id");if(e)try{const i=await fetch(`/api/get_player.php?id=${e}`);if(!i.ok)throw new Error("Игрок не найден");const s=await i.json();if(!s||!s.id)throw new Error("Данные игрока неполные");const a=`/img/player/player_${s.id}.png`,r=document.querySelector(".player-card img");r&&(r.src=a,r.alt=`${s.name} ${s.patronymic||""}`.trim(),r.onerror=()=>{r.src="/img/player/player_0.png"});const o=await fetch(`/api/player_statistics.php?id=${s.id}`);if(!o.ok)throw new Error("Ошибка при загрузке статистики сезона");const l=await o.json(),c=await fetch(`/api/player_statistics_all.php?id=${s.id}`);if(!c.ok)throw new Error("Ошибка при загрузке общей статистики");const m=await c.json(),d=m&&m.length>0?m[0]:{},u=document.querySelector(".player-name"),g=document.querySelector(".player-info");if(u&&(u.textContent=`${s.name} ${s.patronymic||""}`.trim()),g){const e=new Date(s.join_date),i=new Date;let a=i.getFullYear()-e.getFullYear(),r=i.getMonth()-e.getMonth();r<0&&(a--,r+=12);const o=[];a>0&&o.push(`${a} ${n(a,["год","года","лет"])}`),r>0&&o.push(`${r} ${n(r,["месяц","месяца","месяцев"])}`),g.innerHTML=`\n              <p><strong>Номер:</strong> ${s.number}</p>\n            <p><strong>Позиция:</strong> ${s.position}</p>\n            <p><strong>Рост:</strong> ${s.height_cm||"-"} см</p>\n            <p><strong>Вес:</strong> ${s.weight_kg||"-"} кг</p>\n            <p><strong>Возраст:</strong> ${function(e){const t=new Date(e),n=new Date;let i=n.getFullYear()-t.getFullYear();const s=n.getMonth()-t.getMonth();return(s<0||0===s&&n.getDate()<t.getDate())&&i--,i}(s.birth_date)}</p>\n            <p><strong>Присоединился:</strong> ${t(s.join_date,"short")}</p>\n             <p><strong>Дата Рождения:</strong> ${t(s.birth_date,"numeric")}</p>\n            <p><strong>Время в команде:</strong> ${o.join(" ")||"менее месяца"}</p>\n        `}const h=document.querySelector(".season-stats");if(h&&(h.innerHTML=`\n                <div><div class="number">${l.matches||0}</div>Матчей</div>\n                <div><div class="number">${l.goals||0}</div>Голов</div>\n                <div><div class="number">${l.assists||0}</div>Ассистов</div>\n                <div><div class="number">${(l.goals||0)+(l.assists||0)}</div>Гол+пас</div>\n                <div><div class="number">${l.lostgoals||0}</div>Голов пропущено</div>\n                <div><div class="number">${l.zeromatch||0}</div>Матчей на 0</div>\n            `),document.querySelector(".all-stats")){const e=d&&d.matches?{matches:(l.matches||0)+(d.matches||0),goals:(l.goals||0)+(d.goals||0),assists:(l.assists||0)+(d.assists||0),zeromatch:(l.zeromatch||0)+(d.zeromatch||0),lostgoals:(l.lostgoals||0)+(d.lostgoals||0)}:l;document.querySelector(".all-stats").innerHTML=`\n  <div><div class="number number2 matches">${e.matches}</div>Матчей</div>\n  <div><div class="number number2 goals">${e.goals}</div>Голов</div>\n  <div><div class="number number2 assists">${e.assists}</div>Ассистов</div>\n  <div><div class="number">${e.goals+e.assists}</div>Гол+пас</div>\n  <div><div class="number number2 lostgoals">${e.lostgoals}</div>Голов пропущено</div>\n  <div><div class="number number2 zeromatch">${e.zeromatch}</div>Матчей на 0</div>\n`,function(e){const t=[{limit:500,name:"Новичок"},{limit:1e3,name:"Перспективный"},{limit:2500,name:"Футболист"},{limit:5e3,name:"Опытный"},{limit:7500,name:"Старожил"},{limit:1e4,name:"Мастер"},{limit:12500,name:"Герой"},{limit:15e3,name:"Магистр"},{limit:2e4,name:"Посвященный"},{limit:25e3,name:"Ветеран"},{limit:3e4,name:"Виртуоз"},{limit:35e3,name:"Элита"},{limit:45e3,name:"Чемпион"},{limit:6e4,name:"Хранитель"},{limit:75e3,name:"Вершитель"},{limit:9e4,name:"Избранный"},{limit:1/0,name:"Легенда"}];let n=0;for(let i=0;i<t.length;i++)if(e<=t[i].limit){n=i;break}const i=t[n],s=0===n?0:t[n-1].limit,a=(i.limit,i.limit),r=e-s,o=a-s,l=a===1/0?100:Math.min(100,r/o*100),c=document.getElementById("experience-bar-fill"),m=document.getElementById("experience-bar-text"),d=document.getElementById("title");c&&(c.style.width=l+"%"),m&&(m.textContent=a===1/0?`${e} / ∞`:`${e} / ${a}`),d&&(d.textContent=i.name)}(function(){const e=sum("matches"),t=sum("goals"),n=sum("assists"),i=sum("zeromatch");let s=0,a=0;if(g){const e=[...g.querySelectorAll("p")].find((e=>e.querySelector("strong")?.textContent.includes("Время в команде")));if(e){const t=e.textContent,n=t.match(/(\d+)\s(год|года|лет)/),i=t.match(/(\d+)\s(месяц|месяца|месяцев)/);n&&(s=parseInt(n[1])),i&&(a=parseInt(i[1]))}}return 100*(12*s+a)+50*e+125*t+100*n+250*i}())}document.getElementById("achievements-block");const p=document.querySelector(".achievements-card"),v=document.querySelector(".achievements-list");try{const e=await fetch(`/api/achievements.php?player_id=${s.id}`);if(!e.ok)throw new Error("Ошибка при получении достижений");const t=await e.json();if(p.style.display="block",v.innerHTML="",t?.length)t.forEach((e=>{const t=document.createElement("div");t.classList.add("career-item"),t.innerHTML=`\n                        ${e.award_title}<span>${e.award_year}</span>\n                        <small>${e.team_name}</small>\n                    `,v.appendChild(t)}));else{const e=document.createElement("div");e.classList.add("empty-achievements"),e.textContent="Нет достижений",v.appendChild(e)}}catch(e){console.error("Ошибка при загрузке достижений:",e),p.style.display="block",v.innerHTML='<div class="error-msg">Не удалось загрузить достижения</div>'}}catch(e){console.error("Ошибка при загрузке данных игрока:",e)}else console.error("ID игрока не указан в URL");function t(e,t="full"){const n=new Date(e);return"short"===t?n.getFullYear().toString():"numeric"===t?`${String(n.getDate()).padStart(2,"0")}.${String(n.getMonth()+1).padStart(2,"0")}.${n.getFullYear()}`:n.toLocaleDateString("ru-RU",{year:"numeric",month:"long",day:"numeric"})}function n(e,t){const n=e%10,i=e%100;return i>=11&&i<=14?t[2]:1===n?t[0]:n>=2&&n<=4?t[1]:t[2]}}));