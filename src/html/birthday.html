<!DOCTYPE html>
<html lang="ru">

<head>
    <meta charset="UTF-8">
    <title>Открытка на День Рождения</title>
    <link href="https://fonts.googleapis.com/css2?family=Play:wght@700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Play', sans-serif;
            text-align: center;
            background-color: #222;
            color: white;
        }

        canvas {
            border: 1px solid #ccc;
            margin-top: 10px;
            max-width: 100%;
        }

        input,
        button {
            margin: 5px;
            padding: 5px;
            font-size: 16px;
        }

        label {
            display: inline-block;
            margin: 5px;

        }
    </style>
</head>

<body>
    <h1>Создай картинку с днем рождения</h1>
    <input type="file" id="upload" accept="image/*"><br>
    <label>Размер фото: <input type="range" id="scale" min="0.2" max="2" step="0.01" value="1"></label><br>
    <label>Дата: <input type="text" id="dateText" placeholder="31.07.2025"></label><br>
    <label>Фамилия и имя: <input type="text" id="nameText" placeholder="Иванов Иван"></label><br>
    <button id="save">Сохранить</button><br><br>
    <canvas id="canvas" width="768" height="768"></canvas>

    <script>
        const bg = new Image();
        bg.src = 'img/birthday.png';

        const canvas = document.getElementById('canvas');
        const ctx = canvas.getContext('2d');

        let uploadedImg = null;
        let scale = 1;

        const draw = () => {
            ctx.clearRect(0, 0, canvas.width, canvas.height);

            // Фото
            if (uploadedImg) {
                const imgW = uploadedImg.width * scale;
                const imgH = uploadedImg.height * scale;
                const x = (canvas.width - imgW) / 2;
                const y = (canvas.height - imgH) / 2;
                ctx.drawImage(uploadedImg, x, y, imgW, imgH);
            }

            // Рамка
            ctx.drawImage(bg, 0, 0, canvas.width, canvas.height);

            // Дата
            const date = document.getElementById('dateText').value;
            ctx.save();
            ctx.translate(240, 637); // позиция даты
            ctx.rotate(-Math.PI / 19); // наклон
            ctx.font = 'bold 26px "Play"';
            ctx.fillStyle = 'black';
            ctx.textAlign = 'center';
            ctx.fillText(date, 0, 0);
            ctx.restore();

            // ФИО
            const name = document.getElementById('nameText').value;
            ctx.save();
            ctx.translate(325, 690); // позиция ФИО
            ctx.rotate(-Math.PI / 19); // наклон
            ctx.font = 'bold 28px "Play"';
            ctx.fillStyle = 'black';
            ctx.textAlign = 'center';
            ctx.fillText(name.toUpperCase(), 0, 0);
            ctx.restore();
        };

        // Фото
        document.getElementById('upload').addEventListener('change', (e) => {
            const file = e.target.files[0];
            if (!file) return;
            const reader = new FileReader();
            reader.onload = () => {
                uploadedImg = new Image();
                uploadedImg.onload = draw;
                uploadedImg.src = reader.result;
            };
            reader.readAsDataURL(file);
        });

        document.getElementById('scale').addEventListener('input', (e) => {
            scale = parseFloat(e.target.value);
            draw();
        });

        document.getElementById('dateText').addEventListener('input', draw);
        document.getElementById('nameText').addEventListener('input', draw);

        document.getElementById('save').addEventListener('click', () => {
            const link = document.createElement('a');
            link.download = 'открытка.png';
            link.href = canvas.toDataURL('image/png');
            link.click();
        });

        bg.onload = draw;
    </script>
</body>

</html>