<!DOCTYPE html>
<html lang="ru">

<head>
    <meta charset="UTF-8">
    <title>Генератор Squad List</title>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Montserrat', sans-serif;
            text-align: center;
            background-color: #222;
            color: white;
        }

        canvas {
            border: 1px solid #ccc;
            margin-top: 10px;
            background: white;
            max-width: 100%;
        }

        input,
        button {
            margin: 5px;
            padding: 5px;
            font-size: 16px;
        }

        label {
            display: block;
            margin: 10px auto;
            text-align: left;
            max-width: 500px;
        }

        #playersContainer {
            margin: 20px auto;
            max-width: 500px;
            text-align: left;
        }

        .playerRow {
            display: flex;
            gap: 10px;
            margin-bottom: 5px;
        }

        .playerRow input {
            flex: 1;
        }

        a#download {
            display: block;
            margin-top: 10px;
            color: white;
        }
    </style>
</head>

<body>
    <h1>Генератор Squad List</h1>

    <label>Дата: <input type="text" id="dateText" placeholder="27.01.2024"></label>
    <label>Чемпионат: <input type="text" id="tournamentText" placeholder="MFL-2"></label>
    <label>Тур: <input type="text" id="roundText" placeholder="1/2 финала, тур 8, матч за бронзу и т.п."></label>
    <label>Стадион: <input type="text" id="stadiumText" placeholder="Kosino Stadium"></label>

    <div id="playersContainer"></div>
    <button id="addPlayerBtn">+ Добавить игрока</button><br>
    <button id="save">Скачать изображение</button>

    <canvas id="canvas" width="768" height="768"></canvas>

    <script>
        const canvas = document.getElementById('canvas');
        const ctx = canvas.getContext('2d');
        const bg = new Image();
        let bgLoaded = false;

        bg.src = 'img/squadlist8x8.png';

        const playersContainer = document.getElementById('playersContainer');
        const addPlayerBtn = document.getElementById('addPlayerBtn');
        const saveBtn = document.getElementById('save');

        const draw = () => {
            if (!bgLoaded) return;

            ctx.clearRect(0, 0, canvas.width, canvas.height);
            ctx.drawImage(bg, 0, 0, canvas.width, canvas.height);

            const date = document.getElementById('dateText').value;
            const tournament = document.getElementById('tournamentText').value;
            const round = document.getElementById('roundText').value;
            const stadium = document.getElementById('stadiumText').value;

            // Заголовок (дата, турнир, тур)
            ctx.save();
            ctx.translate(410, 125);
            ctx.rotate(-0.15);
            ctx.font = 'bold 20px "Montserrat"';
            ctx.fillStyle = 'black';
            ctx.textAlign = 'center';
            if (date) ctx.fillText(date, 0, 0);
            if (tournament) ctx.fillText(tournament, 0, 25);
            if (round) ctx.fillText(round, 0, 50); // Просто выводим то, что введено
            ctx.restore();

            // Игроки
            ctx.save();
            ctx.translate(250, 300);
            ctx.rotate(-0.15);

            ctx.textAlign = 'left';
            const lineHeight = 24;
            const rows = playersContainer.querySelectorAll('.playerRow');

            rows.forEach((row, index) => {
                const inputs = row.querySelectorAll('input');
                const number = inputs[0].value.trim();
                const name = inputs[1].value.trim();

                if (number && name) {
                    const y = index * lineHeight;
                    ctx.font = 'bold 20px "Montserrat"';
                    ctx.fillText(number, 0, y);
                    ctx.font = '20px "Montserrat"';
                    ctx.fillText(name.toUpperCase(), 40, y);
                }
            });

            ctx.restore();

            // Стадион
            ctx.save();
            ctx.translate(410, 715);
            ctx.rotate(-0.15);
            ctx.font = 'bold 16px "Montserrat"';
            ctx.textAlign = 'left';
            ctx.fillText(stadium.toUpperCase(), 0, 0);
            ctx.restore();
        };

        const addPlayerRow = (number = '', name = '') => {
            const div = document.createElement('div');
            div.className = 'playerRow';
            div.innerHTML = `
        <input type="text" placeholder="№" value="${number}">
        <input type="text" placeholder="Фамилия" value="${name}">
      `;
            playersContainer.appendChild(div);
            div.querySelectorAll('input').forEach(input => input.addEventListener('input', draw));
        };

        for (let i = 0; i < 8; i++) addPlayerRow();

        addPlayerBtn.addEventListener('click', () => addPlayerRow());

        document.querySelectorAll('#dateText, #tournamentText, #roundText, #stadiumText')
            .forEach(el => el.addEventListener('input', draw));

        saveBtn.addEventListener('click', () => {
            draw();
            const link = document.createElement('a');
            link.download = 'squadlist.png';
            link.href = canvas.toDataURL('image/png');
            link.click();
        });

        bg.onload = () => {
            bgLoaded = true;
            draw();
        };
    </script>
</body>

</html>