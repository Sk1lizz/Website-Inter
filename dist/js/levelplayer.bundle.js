document.addEventListener("DOMContentLoaded",(async()=>{const t=new URLSearchParams(window.location.search).get("id");if(t)try{const i=await fetch(`/api/players/number/${t}`);if(!i.ok)throw new Error("Игрок не найден");const r=await i.json();if(!r||!r.id)throw new Error("Данные игрока неполные");const s=`/img/player/player_${r.id}.png`,a=document.querySelector(".player-card img");a&&(a.src=s,a.alt=`${r.name} ${r.patronymic||""}`.trim(),a.onerror=()=>{a.src="/img/player/player_0.png"});const o=await fetch(`/api/admin/players/${r.id}/statistics`);if(!o.ok)throw new Error("Ошибка при загрузке статистики сезона");const l=await o.json(),m=await fetch(`/api/admin/players/${r.id}/statistics/all`);if(!m.ok)throw new Error("Ошибка при загрузке общей статистики");const c=await m.json(),d=c&&c.length>0?c[0]:{},g=document.querySelector(".player-name"),u=document.querySelector(".player-info");if(g&&(g.textContent=`${r.name} ${r.patronymic||""}`.trim()),u){const t=new Date(r.join_date),i=new Date;let s=i.getFullYear()-t.getFullYear(),a=i.getMonth()-t.getMonth();a<0&&(s--,a+=12);const o=[];s>0&&o.push(`${s} ${n(s,["год","года","лет"])}`),a>0&&o.push(`${a} ${n(a,["месяц","месяца","месяцев"])}`),u.innerHTML=`\n              <p><strong>Номер:</strong> ${r.number}</p>\n            <p><strong>Позиция:</strong> ${r.position}</p>\n            <p><strong>Рост:</strong> ${r.height_cm||"-"} см</p>\n            <p><strong>Вес:</strong> ${r.weight_kg||"-"} кг</p>\n            <p><strong>Возраст:</strong> ${function(t){const e=new Date(t),n=new Date;let i=n.getFullYear()-e.getFullYear();const r=n.getMonth()-e.getMonth();return(r<0||0===r&&n.getDate()<e.getDate())&&i--,i}(r.birth_date)}</p>\n            <p><strong>Присоединился:</strong> ${e(r.join_date,"short")}</p>\n             <p><strong>Дата Рождения:</strong> ${e(r.birth_date,"numeric")}</p>\n            <p><strong>Время в команде:</strong> ${o.join(" ")||"менее месяца"}</p>\n        `}const v=document.querySelector(".season-stats");v&&(v.innerHTML=`\n                <div><div class="number">${l.matches||0}</div>Матчей</div>\n                <div><div class="number">${l.goals||0}</div>Голов</div>\n                <div><div class="number">${l.assists||0}</div>Ассистов</div>\n                <div><div class="number">${(l.goals||0)+(l.assists||0)}</div>Гол+пас</div>\n                <div><div class="number">${l.lostgoals||0}</div>Голов пропущено</div>\n                <div><div class="number">${l.zeromatch||0}</div>Матчей на 0</div>\n            `);const p=document.querySelector(".all-stats");if(p){const t=t=>(l[t]||0)+(d[t]||0);p.innerHTML=`\n                <div><div class="number number2 matches">${t("matches")}</div>Матчей</div>\n                <div><div class="number number2 goals">${t("goals")}</div>Голов</div>\n                <div><div class="number number2 assists">${t("assists")}</div>Ассистов</div>\n                <div><div class="number">${t("goals")+t("assists")}</div>Гол+пас</div>\n                <div><div class="number number2 lostgoals">${t("lostgoals")}</div>Голов пропущено</div>\n                <div><div class="number number2 zeromatch">${t("zeromatch")}</div>Матчей на 0</div>\n            `,function(t){const e=[{limit:500,name:"Новичок"},{limit:1e3,name:"Перспективный"},{limit:2500,name:"Футболист"},{limit:5e3,name:"Опытный"},{limit:7500,name:"Старожил"},{limit:1e4,name:"Мастер"},{limit:12500,name:"Герой"},{limit:15e3,name:"Магистр"},{limit:2e4,name:"Посвященный"},{limit:25e3,name:"Ветеран"},{limit:3e4,name:"Виртуоз"},{limit:35e3,name:"Элита"},{limit:45e3,name:"Чемпион"},{limit:6e4,name:"Хранитель"},{limit:75e3,name:"Вершитель"},{limit:9e4,name:"Избранный"},{limit:1/0,name:"Легенда"}];let n=0;for(let i=0;i<e.length;i++)if(t<=e[i].limit){n=i;break}const i=e[n],r=0===n?0:e[n-1].limit,s=(i.limit,i.limit),a=t-r,o=s-r,l=s===1/0?100:Math.min(100,a/o*100),m=document.getElementById("experience-bar-fill"),c=document.getElementById("experience-bar-text"),d=document.getElementById("title");m&&(m.style.width=l+"%"),c&&(c.textContent=s===1/0?`${t} / ∞`:`${t} / ${s}`),d&&(d.textContent=i.name)}(function(){const e=t("matches"),n=t("goals"),i=t("assists"),r=t("zeromatch");let s=0,a=0;if(u){const t=[...u.querySelectorAll("p")].find((t=>t.querySelector("strong")?.textContent.includes("Время в команде")));if(t){const e=t.textContent,n=e.match(/(\d+)\s(год|года|лет)/),i=e.match(/(\d+)\s(месяц|месяца|месяцев)/);n&&(s=parseInt(n[1])),i&&(a=parseInt(i[1]))}}return 100*(12*s+a)+50*e+125*n+100*i+250*r}())}}catch(t){console.error("Ошибка при загрузке данных игрока:",t)}else console.error("ID игрока не указан в URL");function e(t,e="full"){const n=new Date(t);return"short"===e?n.getFullYear().toString():"numeric"===e?`${String(n.getDate()).padStart(2,"0")}.${String(n.getMonth()+1).padStart(2,"0")}.${n.getFullYear()}`:n.toLocaleDateString("ru-RU",{year:"numeric",month:"long",day:"numeric"})}function n(t,e){const n=t%10,i=t%100;return i>=11&&i<=14?e[2]:1===n?e[0]:n>=2&&n<=4?e[1]:e[2]}}));